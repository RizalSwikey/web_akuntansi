{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard - Harga Pokok Produksi {% endblock %}

{% block content %}
<div class="bg-white text-slate-800">
  <div class="flex gap-6">

    {% include 'core/partials/side_menu.html' %}

    <main id="main-content" class="flex-1">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Harga Pokok Produksi</h1>
        <button
          id="add-hpp-btn"
          class="bg-[#4A5C51] text-white font-semibold py-2 px-6 rounded-lg hover:bg-[#3a4a40]"
        >
          TAMBAH
        </button>
      </div>
      <div class="bg-white rounded-2xl p-8 shadow-sm">
        <h2 class="text-xl font-bold mb-4 text-center">PERSEDIAAN AWAL</h2>
        <div
          class="grid grid-cols-5 gap-4 bg-slate-100 p-4 rounded-lg mb-2 text-slate-600 font-semibold"
        >
          <div>Nama Produk</div>
          <div>Kuantitas</div>
          <div>Keterangan</div>
          <div>Harga Beli Satuan (Rp)</div> {# Updated header #}
          <div>Total (Rp)</div> {# Updated header #}
        </div>
        <div id="persediaan-awal-rows" class="space-y-2">
            {# Rows will be added here by JS #}
        </div>
        <div class="text-right font-bold text-lg mt-6">
          JUMLAH PERSEDIAAN AWAL <span id="jumlah-persediaan-awal">Rp 0</span>
        </div>

        <hr class="my-10 border-slate-200" /> {# Added border style #}

        <h2 class="text-xl font-bold mb-4 text-center">PEMBELIAN</h2>
        <div
          class="grid grid-cols-4 gap-4 bg-slate-100 p-4 rounded-lg mb-2 text-slate-600 font-semibold"
        >
          <div>Nama Produk</div>
          <div>Kuantitas</div>
          <div>Keterangan</div>
          <div>Harga Satuan (Rp)</div> {# Updated header #}
        </div>
        <div id="pembelian-rows-part1" class="space-y-2">
            {# Rows part 1 will be added here by JS #}
        </div>

        <div
          class="grid grid-cols-5 gap-4 bg-slate-100 p-4 rounded-lg mb-2 text-slate-600 font-semibold mt-10"
        >
          <div>Diskon Pembelian (Rp)</div> {# Updated header #}
          <div>Retur Pembelian (Qty)</div> {# Updated header #}
          <div>Jumlah Retur (Rp)</div> {# Updated header #}
          <div>Biaya Ongkir (Rp)</div> {# Updated header #}
          <div>Total Pembelian (Rp)</div> {# Updated header #}
        </div>
        <div id="pembelian-rows-part2" class="space-y-2">
            {# Rows part 2 will be added here by JS #}
        </div>
        <div class="text-right font-bold text-lg mt-6">
          JUMLAH PEMBELIAN <span id="jumlah-pembelian">Rp 0</span>
        </div>

        <hr class="my-10 border-slate-200" /> {# Added border style #}

        <h2 class="text-xl font-bold mb-4 text-center">PERSEDIAAN AKHIR</h2>
        <div
          class="grid grid-cols-5 gap-4 bg-slate-100 p-4 rounded-lg mb-2 text-slate-600 font-semibold"
        >
          <div>Nama Produk</div>
          <div>Kuantitas</div>
          <div>Keterangan</div>
          <div>Total (Rp)</div> {# Updated header #}
          <div>Status</div> {# Changed header from Keterangan #}
        </div>
        <div id="persediaan-akhir-rows" class="space-y-2">
             {# Rows will be added here by JS #}
        </div>
        <div class="text-right font-bold text-lg mt-6">
          JUMLAH PERSEDIAAN AKHIR
          <span id="jumlah-persediaan-akhir">Rp 0</span>
        </div>

        <div class="text-right mt-16">
          {# Consider adding functionality or linking this button #}
          <button
            id="hpp-next-btn"
            class="py-3 px-12 bg-[#8C705A] text-white font-semibold rounded-lg hover:bg-[#a1826a]"
            onclick="window.location.href='{% url 'core:beban_usaha' %}'" {# Example: Link to next page #}
          >
            Next
          </button>
        </div>
      </div>
    </main>
  </div>

  {# --- MODAL --- #}
  <div
    id="add-hpp-modal"
    class="fixed inset-0 bg-black/60 flex justify-center items-start z-50 overflow-y-auto py-10 transition-opacity opacity-0 pointer-events-none"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md">
      <form id="hpp-form">
        <div class="mb-5">
          <label
            for="hpp-product-name"
            class="block mb-2 font-semibold text-slate-600"
            >Nama produk</label
          ><input
            type="text"
            id="hpp-product-name"
            class="w-full p-3 border border-slate-300 rounded-lg"
            required
          />
        </div>

        {# Fields for Persediaan Awal #}
        <div id="hpp-awal-fields">
          <div class="mb-5">
            <label
              for="hpp-awal-kuantitas"
              class="block mb-2 font-semibold text-slate-600"
              >Kuantitas</label
            ><input
              type="number"
              id="hpp-awal-kuantitas"
              class="w-full p-3 border border-slate-300 rounded-lg"
              min="0" {# Added min value #}
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-awal-keterangan"
              class="block mb-2 font-semibold text-slate-600"
              >Keterangan kuantitas</label
            ><input
              type="text"
              id="hpp-awal-keterangan"
              class="w-full p-3 border border-slate-300 rounded-lg"
              placeholder="Contoh: pcs, kg, box" {# Added placeholder #}
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-awal-harga"
              class="block mb-2 font-semibold text-slate-600"
              >Harga Beli Satuan</label
            ><input
              type="number"
              id="hpp-awal-harga"
              class="w-full p-3 border border-slate-300 rounded-lg"
               min="0" {# Added min value #}
               placeholder="Rp" {# Added placeholder #}
            />
          </div>
        </div>

        {# Fields for Pembelian (Initially hidden) #}
        <div id="hpp-pembelian-fields" class="hidden">
          <div class="mb-5">
            <label
              for="hpp-pembelian-kuantitas"
              class="block mb-2 font-semibold text-slate-600"
              >Kuantitas</label
            ><input
              type="number"
              id="hpp-pembelian-kuantitas"
              class="w-full p-3 border border-slate-300 rounded-lg"
               min="0"
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-pembelian-keterangan"
              class="block mb-2 font-semibold text-slate-600"
              >Keterangan Kuantitas</label {# Clarified label #}
            ><input
              type="text"
              id="hpp-pembelian-keterangan"
              class="w-full p-3 border border-slate-300 rounded-lg"
              placeholder="Contoh: pcs, kg, box"
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-pembelian-harga"
              class="block mb-2 font-semibold text-slate-600"
              >Harga Satuan</label
            ><input
              type="number"
              id="hpp-pembelian-harga"
              class="w-full p-3 border border-slate-300 rounded-lg"
               min="0"
               placeholder="Rp"
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-pembelian-diskon"
              class="block mb-2 font-semibold text-slate-600"
              >Diskon Pembelian</label
            ><input
              type="number"
              id="hpp-pembelian-diskon"
              class="w-full p-3 border border-slate-300 rounded-lg"
              min="0"
              placeholder="Rp (jika tidak ada, isi 0)" {# Added placeholder #}
              value="0" {# Default value 0 #}
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-pembelian-retur"
              class="block mb-2 font-semibold text-slate-600"
              >Retur Pembelian (Qty)</label
            ><input
              type="number"
              id="hpp-pembelian-retur"
              class="w-full p-3 border border-slate-300 rounded-lg"
              min="0"
              placeholder="Jumlah unit diretur (jika tidak ada, isi 0)" {# Added placeholder #}
              value="0" {# Default value 0 #}
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-pembelian-ongkir"
              class="block mb-2 font-semibold text-slate-600"
              >Biaya Ongkir</label
            ><input
              type="number"
              id="hpp-pembelian-ongkir"
              class="w-full p-3 border border-slate-300 rounded-lg"
              min="0"
              placeholder="Rp (jika tidak ada, isi 0)" {# Added placeholder #}
               value="0" {# Default value 0 #}
            />
          </div>
        </div>

        {# Fields for Persediaan Akhir (Initially hidden) #}
        <div id="hpp-akhir-fields" class="hidden">
          <div class="mb-5">
            <label
              for="hpp-akhir-kuantitas"
              class="block mb-2 font-semibold text-slate-600"
              >Kuantitas Tersisa</label {# Clarified label #}
            ><input
              type="number"
              id="hpp-akhir-kuantitas"
              class="w-full p-3 border border-slate-300 rounded-lg"
              min="0"
              placeholder="Jumlah unit di akhir periode" {# Added placeholder #}
            />
          </div>
          <div class="mb-5">
            <label
              for="hpp-akhir-keterangan"
              class="block mb-2 font-semibold text-slate-600"
              >Keterangan Kuantitas</label {# Clarified label #}
            ><input
              type="text"
              id="hpp-akhir-keterangan"
              class="w-full p-3 border border-slate-300 rounded-lg"
               placeholder="Contoh: pcs, kg, box"
            />
          </div>
        </div>

        {# Dropdown to select data type #}
        <div class="mb-8">
          <label
            for="hpp-jenis-data"
            class="block mb-2 font-semibold text-slate-600"
            >Jenis Data</label
          ><select
            id="hpp-jenis-data"
            class="w-full p-3 border border-slate-300 rounded-lg bg-white appearance-none" style="background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 20 20\'%3e%3cpath stroke=\'%236b7280\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1.5\' d=\'M6 8l4 4 4-4\'/%3e%3c/svg%3e'); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;"
          >
            <option value="persediaan_awal">Persediaan Awal</option>
            <option value="pembelian">Pembelian</option>
            <option value="persediaan_akhir">Persediaan Akhir</option>
          </select>
        </div>

        <button
          type="submit"
          class="w-full bg-[#4A5C51] text-white p-3 rounded-lg font-semibold text-lg mt-4 hover:bg-[#3a4a40]"
        >
          Selesai & Tambah Data
        </button>
      </form>
    </div>
  </div>

  {# --- ALERTS --- #}
  <div
    id="success-alert"
    class="fixed inset-0 bg-black/40 flex justify-center items-center z-50 transition-opacity opacity-0 pointer-events-none"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm text-center">
      <svg
        class="w-16 h-16 text-green-500 mx-auto mb-4"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <p class="text-lg font-semibold">Data berhasil ditambahkan</p> {# Updated message #}
    </div>
  </div>
  <div
    id="error-alert"
    class="fixed inset-0 bg-black/40 flex justify-center items-center z-50 transition-opacity opacity-0 pointer-events-none"
  >
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm text-center">
      <svg
        class="w-16 h-16 text-red-500 mx-auto mb-4"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
        />
      </svg>
      <p class="text-lg font-semibold">
        Gagal menambahkan data!<br />Pastikan semua field terisi dengan benar.
      </p> {# Updated message #}
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
{# Load the correct JS file #}
<script src="{% static 'core/js/hpp.js' %}"></script>
{% endblock %}