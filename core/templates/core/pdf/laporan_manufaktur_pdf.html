{% load humanize %}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Laporan Manufaktur - {{ report.company_name }}</title>
    <style>
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11px;
            line-height: 1.5;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 800px;
            margin: 0 auto;
            padding: 40px;
            margin-bottom: 60px; /* Ruang untuk footer */
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        .company-name {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
        }
        .report-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0;
        }
        .report-period {
            font-size: 12px;
            color: #6b7280;
            margin: 0;
        }
        .section-title {
            font-weight: bold;
            font-size: 14px;
            margin-top: 20px;
            margin-bottom: 8px;
        }
        
        .footer {
            position: fixed; /* Kunci utamanya: 'cetak' di posisi tetap */
            bottom: 0;       /* Letakkan 0px dari bawah */
            left: 0;
            right: 0;
            width: 100%;
            text-align: center;
            font-size: 10px;
            color: #9ca3af; /* text-gray-400 */
            border-top: 1px solid #e5e7eb; 
            padding: 10px 0;
            background-color: #ffffff; /* Beri background putih */
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }
        .data-table tr {
            border-bottom: 1px solid #e5e7eb;
        }
        .data-table td {
            padding: 8px 4px;
        }
        .data-table .label {
            text-align: left;
        }
        .data-table .amount {
            text-align: right;
            font-weight: 600;
            /* Mencegah angka terpotong */
            white-space: nowrap;
        }
        
        .total-row {
            border-top: 1px solid #9ca3af;
        }
        .total-row .label,
        .total-row .amount {
            font-weight: bold;
            font-size: 12px;
            padding-top: 10px;
        }
        
        .highlight-row td {
            background-color: #f3f4f6;
            padding: 12px 8px;
            font-weight: bold;
            font-size: 13px;
        }

        /* Untuk Laba (Hijau) */
        .profit-row td {
            background-color: #d1fae5; /* bg-green-100 */
            color: #065f46; /* text-green-700 */
            padding: 12px 8px;
            font-weight: bold;
            font-size: 13px;
        }
        
        /* Untuk Rugi (Merah) */
        .loss-row td {
            background-color: #fee2e2; /* bg-red-100 */
            color: #b91c1c; /* text-red-700 */
            padding: 12px 8px;
            font-weight: bold;
            font-size: 13px;
        }

        .indent-1 {
            padding-left: 24px !important;
        }
        .indent-2 {
            padding-left: 48px !important;
        }
        .sub-header {
            font-weight: 600;
            color: #374151;
            padding-top: 12px;
        }
        .negative {
            /* Tampilkan dalam format (Rp xxx) */
        }

    </style>
</head>
<body>

    <div class="footer">
        Â© {{ report.year|default:"2025" }} JurnalKita - Laporan dibuat secara otomatis
    </div>
    
    <div class="container">

        <div class="header">
            <p class="company-name">{{ report.company_name|default:"Nama Perusahaan" }}</p>
            <p class="report-title">LAPORAN HARGA POKOK PRODUKSI</p>
            <p class="report-period">{{ report.month|default:"Bulan" }} {{ report.year|default:"Tahun" }}</p>
        </div>

        <div class="section-title">Biaya Bahan Baku</div>
        <table class="data-table">
            <tr>
                <td class="label indent-1">Persediaan bahan baku (awal)</td>
                <td class="amount">Rp {{ total_bb_awal|floatformat:0|intcomma }}</td>
            </tr>
            <tr>
                <td class="label indent-1">Pembelian Bahan Baku</td>
                <td class="amount">Rp {{ total_bb_pembelian|floatformat:0|intcomma }}</td>
            </tr>
            <tr class="total-row">
                <td class="label indent-1">Persediaan Bahan Baku yang tersedia diproduksi</td>
                <td class="amount">Rp {{ total_bb_awal|add:total_bb_pembelian|floatformat:0|intcomma }}</td>
            </tr>
            <tr>
                <td class="label indent-1">Persediaan Bahan Baku (akhir)</td>
                <td class="amount negative">(Rp {{ total_bb_akhir|floatformat:0|intcomma }})</td>
            </tr>
            <tr class="total-row">
                <td class="label">Total Biaya Bahan Baku</td>
                <td class="amount">Rp {{ total_bbb|floatformat:0|intcomma }}</td>
            </tr>
        </table>

        <table class="data-table">
            <tr>
                <td class="label section-title" style="margin-top: 0;">Biaya Tenaga Kerja Langsung</td>
                <td class="amount section-title" style="margin-top: 0;">Rp {{ total_btkl|floatformat:0|intcomma }}</td>
            </tr>
        </table>
        
        <div class="section-title">Biaya Overhead Pabrik</div>
        <table class="data-table">
            {% for item in bop_items %}
            <tr>
                <td class="label indent-1">{{ item.nama_biaya }}</td>
                <td class="amount">Rp {{ item.total|floatformat:0|intcomma }}</td>
            </tr>
            {% empty %}
            <tr>
                <td class="label indent-1" style="color: #6b7280;">- Tidak ada data BOP -</td>
                <td class="amount">Rp 0</td>
            </tr>
            {% endfor %}
            <tr class="total-row">
                <td class="label indent-1">Total Biaya Overhead Pabrik</td>
                <td class="amount">Rp {{ total_bop|floatformat:0|intcomma }}</td>
            </tr>
        </table>

        <table class="data-table">
            <tr class="total-row" style="border-bottom: 1px solid #e5e7eb;">
                <td class="label section-title" style="margin-top: 0;">Total Biaya Produksi Tahun ini</td>
                <td class="amount section-title" style="margin-top: 0;">Rp {{ total_biaya_produksi|floatformat:0|intcomma }}</td>
            </tr>
            <tr>
                <td class="label">Persediaan Barang Dalam Proses (BDP Awal)</td>
                <td class="amount">Rp {{ total_bdp_awal|floatformat:0|intcomma }}</td>
            </tr>
            <tr class="total-row">
                <td class="label">Total Biaya Barang Dalam Proses</td>
                <td class="amount">Rp {{ total_biaya_produksi|add:total_bdp_awal|floatformat:0|intcomma }}</td>
            </tr>
            <tr>
                <td class="label">Persediaan Barang Dalam Proses (Akhir)</td>
                <td class="amount negative">(Rp {{ total_bdp_akhir|floatformat:0|intcomma }})</td>
            </tr>
            <tr class="highlight-row">
                <td class="label">Cost of Goods Manufactured (COGM)</td>
                <td class="amount">Rp {{ cogm|floatformat:0|intcomma }}</td>
            </tr>
        </table>

        <table class="data-table" style="margin-top: 20px;">
             <tr>
                <td class="label">Persediaan Barang Jadi (Awal)</td>
                <td class="amount">Rp {{ total_bj_awal|floatformat:0|intcomma }}</td>
            </tr>
            <tr class="total-row">
                <td class="label">Total Biaya Barang Siap untuk Dijual</td>
                <td class="amount">Rp {{ barang_siap_dijual|floatformat:0|intcomma }}</td>
            </tr>
            <tr>
                <td class="label">Persediaan Barang Jadi (Akhir)</td>
                <td class="amount negative">(Rp {{ total_bj_akhir|floatformat:0|intcomma }})</td>
            </tr>
            <tr class="highlight-row">
                <td class="label">Harga Pokok Penjualan (HPP)</td>
                <td class="amount">Rp {{ total_hpp|floatformat:0|intcomma }}</td>
            </tr>
        </table>
        
        <div class="section-title" style="margin-top: 16px;">HPP Per Produk</div>
        <table class="data-table">
            {% for item in hpp_per_product %}
            <tr>
                <td class="label indent-1">HPP Per {{ item.product.name }}</td>
                <td class="amount">Rp {{ item.hpp_per_unit|floatformat:0|intcomma }}</td>
            </tr>
            {% empty %}
             <tr>
                <td class="label indent-1" style="color: #6b7280;">- Tidak ada data HPP per produk -</td>
            </tr>
            {% endfor %}
        </table>

        <hr style="page-break-before: always; border: none; margin: 0; padding: 0;">

        <div class="header" style="padding-top: 40px;"> 
            <p class="company-name">{{ report.company_name|default:"Nama Perusahaan" }}</p>
            <p class="report-title">LAPORAN LABA RUGI</p>
            <p class="report-period">{{ report.month|default:"Bulan" }} {{ report.year|default:"Tahun" }}</p>
        </div>

        <div class="section-title">Pendapatan</div>
        <table class="data-table">
            <tr>
                <td class="label indent-1">Pendapatan Usaha</td>
                <td class="amount">Rp {{ total_pendapatan_usaha|floatformat:0|intcomma }}</td>
            </tr>
            <tr>
                <td class="label indent-1">Pendapatan Lain - Lain</td>
                <td class="amount">Rp {{ total_pendapatan_lain|floatformat:0|intcomma }}</td>
            </tr>
            <tr class="total-row">
                <td class="label">Jumlah Pendapatan</td>
                <td class="amount">Rp {{ jumlah_pendapatan|floatformat:0|intcomma }}</td>
            </tr>
        </table>

        <div class="section-title">Beban</div>
        <table class="data-table">
            <tr>
                <td class="label indent-1">Beban Usaha - HPP</td>
                <td class="amount">Rp {{ hpp_total|floatformat:0|intcomma }}</td>
            </tr>

            {% if beban_usaha_items %}
            <tr>
                <td class="label sub-header" colspan="2">Beban Usaha Lainnya:</td>
            </tr>
            {% for item in beban_usaha_items %}
            <tr>
                <td class="label indent-2">{{ item.name }}</td>
                <td class="amount">Rp {{ item.total|floatformat:0|intcomma }}</td>
            </tr>
            {% endfor %}
            <tr>
                <td class="label indent-1" style="font-weight: 600;">Total Beban Usaha Lainnya</td>
                <td class="amount">Rp {{ total_beban_usaha_lainnya|floatformat:0|intcomma }}</td>
            </tr>
            {% endif %}

            {% if beban_lain_items %}
            <tr>
                <td classs="label sub-header" colspan="2">Beban Lain - Lain:</td>
            </tr>
            {% for item in beban_lain_items %}
            <tr>
                <td class="label indent-2">{{ item.name }}</td>
                <td class="amount">Rp {{ item.total|floatformat:0|intcomma }}</td>
            </tr>
            {% endfor %}
            <tr>
                <td class="label indent-1" style="font-weight: 600;">Total Beban Lain - Lain</td>
                <td class="amount">Rp {{ total_beban_lain|floatformat:0|intcomma }}</td>
            </tr>
            {% endif %}
            
            <tr class="total-row">
                <td class="label">Jumlah Beban</td>
                <td class="amount">Rp {{ jumlah_beban|floatformat:0|intcomma }}</td>
            </tr>
        </table>

        <div class="section-title">Hasil Akhir</div>
        <table class="data-table">
            
            <tr>
                <td class="label">Laba (Rugi) Sebelum Pajak Penghasilan</td>
                {% if laba_sebelum_pajak < 0 %}
                <td class="amount negative">(Rp {{ laba_sebelum_pajak|floatformat:0|intcomma }})</td>
                {% else %}
                <td class="amount">Rp {{ laba_sebelum_pajak|floatformat:0|intcomma }}</td>
                {% endif %}
            </tr>

            <tr>
                <td class="label">Beban Pajak Penghasilan</td>
                <td class="amount">Rp {{ pajak_penghasilan|floatformat:0|intcomma }}</td>
            </tr>
            
            {% if laba_setelah_pajak < 0 %}
            <tr class="loss-row">
                <td class="label">Laba (Rugi) Setelah Pajak Penghasilan</td>
                <td class="amount">(Rp {{ laba_setelah_pajak|floatformat:0|intcomma }})</td>
            </tr>
            {% else %}
            <tr class="profit-row">
                <td class="label">Laba (Rugi) Setelah Pajak Penghasilan</td>
                <td class="amount">Rp {{ laba_setelah_pajak|floatformat:0|intcomma }}</td>
            </tr>
            {% endif %}
        </table>
        
    </div> 
</body>
</html>